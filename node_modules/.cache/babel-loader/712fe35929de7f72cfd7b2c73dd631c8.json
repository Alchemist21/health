{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n}); // @ts-ignore: Could not find a declaration file for module\n\nvar zone_file_1 = require(\"zone-file\");\n\nvar person_1 = require(\"./person\");\n\nvar profileZoneFiles_1 = require(\"../profileZoneFiles\");\n\nvar profileTokens_1 = require(\"../profileTokens\");\n\nfunction resolveZoneFileToPerson(zoneFile, publicKeyOrAddress, callback) {\n  var zoneFileJson = null;\n\n  try {\n    zoneFileJson = zone_file_1.parseZoneFile(zoneFile);\n\n    if (!zoneFileJson.hasOwnProperty('$origin')) {\n      zoneFileJson = null;\n      throw new Error('zone file is missing an origin');\n    }\n  } catch (e) {\n    console.error(e);\n  }\n\n  var tokenFileUrl = null;\n\n  if (zoneFileJson && Object.keys(zoneFileJson).length > 0) {\n    tokenFileUrl = profileZoneFiles_1.getTokenFileUrl(zoneFileJson);\n  } else {\n    var profile = null;\n\n    try {\n      profile = JSON.parse(zoneFile);\n      var person = person_1.Person.fromLegacyFormat(profile);\n      profile = person.profile();\n    } catch (error) {\n      console.warn(error);\n    }\n\n    callback(profile);\n    return;\n  }\n\n  if (tokenFileUrl) {\n    fetch(tokenFileUrl).then(function (response) {\n      return response.text();\n    }).then(function (responseText) {\n      return JSON.parse(responseText);\n    }).then(function (responseJson) {\n      var tokenRecords = responseJson;\n      var token = tokenRecords[0].token;\n      var profile = profileTokens_1.extractProfile(token, publicKeyOrAddress);\n      callback(profile);\n    }).catch(function (error) {\n      console.warn(error);\n    });\n  } else {\n    console.warn('Token file url not found');\n    callback({});\n  }\n}\n\nexports.resolveZoneFileToPerson = resolveZoneFileToPerson;","map":null,"metadata":{},"sourceType":"script"}